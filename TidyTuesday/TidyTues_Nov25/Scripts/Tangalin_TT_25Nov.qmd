
---
title: "Tangalin_Week_13"
author: "Natalia Tangalin"
format: html
date: today 
knitr:                    
  opts_chunk: 
    message: false
    warning: false
---

##World Bank has developed Statistical Performance Indicators (SPI) to monitor the statistical performance of countries. The SPI focuses on five key dimensions of a country’s statistical performance: (i) data use, (ii) data services, (iii) data products, (iv) data sources, and (v) data infrastructure.


## R Packages wer need
```{r}
library(tidytuesdayR)
library(tidyverse)
library(maps)
library(here)
library(countrycode)      #standardizing country names try to get rid of grey


## Data we need
#tuesdata <- tidytuesdayR::tt_load('2025-11-25')

#Load Data
tuesdata <- tidytuesdayR::tt_load('2025-11-25') # Load the data for the specified TidyTuesday week
spi_data <- tuesdata$spi_indicators               # Extract the Social Progress Index data frame


```

##Social Progress Index (SPI) Overall Score

```{r}

#Clean and Filter for Latest Year and fix country names for mapping
simple_data <- spi_data %>%                            # Start data pipeline with the full SPI data
    filter(year == max(year)) %>%                     # Keep only the rows for the most recent year
    mutate(
        # STEP 1: Use countrycode to standardize most names avoid grey countries
        country = countrycode(
            sourcevar = country,          # Column with the source country name
            origin = "country.name.en",   # Format of your source names
            destination = "country.name", # Target: A clean, common English name
            nomatch = NULL                # Keep the name as is if no match is found
        ),
        #initial attempt to remove grey countries
        country = case_when(                       
            # Common/Standard Fixes (though most are now handled by countrycode)
            country == "United States of America" ~ "USA",
            country == "United Kingdom" ~ "UK",
            country == "Russian Federation" ~ "Russia",
            
            # Specific Fixes (keeping them here for reliability, especially Zaire)
            country == "Cote d'Ivoire" ~ "Ivory Coast",
            country == "Yemen, Rep." ~ "Yemen",
            country == "Venezuela, RB" ~ "Venezuela",
            country == "Türkiye" ~ "Turkey",
            country == "Syrian Arab Republic" ~ "Syria",
            country == "Iran, Islamic Rep." ~ "Iran",
            country == "Egypt, Arab Rep." ~ "Egypt",
            country == "Democratic Republic of the Congo" ~ "Zaire", #still not working
            
            # Other Fixes
            country == "Republic of the Congo" ~ "Republic of Congo", # Standardized name
            country == "Korea, Rep." ~ "South Korea", 
            country == "Korea, Dem. People's Rep." ~ "North Korea",
            
            TRUE ~ country                                   # Default: Keep all other names
        )
    )

# Join Map Data and Plot the Choropleth Map
final_map <- map_data("world") %>%                             
    left_join(simple_data, by = c("region" = "country")) %>% 
    ggplot(aes(x = long, y = lat, group = group, fill = overall_score)) + 
    geom_polygon(color = "white", linewidth = 0.1) +  
    scale_fill_viridis_c(na.value = "grey90",          
                         name = "SPI Overall Score") + 
    theme_void() +                                    
    labs(
        title = "Global Social Progress Index (SPI) Scores", 
        subtitle = paste0("Data for ", max(simple_data$year), " (Higher is Better)"), 
        caption = "Data: World Bank SPI | Visualization: #TidyTuesday" 
    ) +
    # ADDED: Theme modifications to set all text elements to white
    theme(
        plot.title = element_text(color = "white"),#theme void is dark, can't see
        plot.subtitle = element_text(color = "white"),
        plot.caption = element_text(color = "white"),
        legend.title = element_text(color = "white"),
        legend.text = element_text(color = "white")
    )
```
# Save the Map to the Output Folder
```{r}
# Print the plot to the Quarto document output
final_map 

# 5. Save the Map to the Output Folder
ggsave(
    filename = here("TidyTuesday", "TidyTues_Nov25", "Output", "spi_world_map.png"), 
    plot = final_map,
    width = 12,
    height = 6,
    dpi = 300
)
```
##BAR CHART (Top 15 Countries)
```{r}
# Use the simple_data object
# Create the plot object and assign it to final_bar_chart
final_bar_chart <- ggplot(
    arrange(
        slice_head(simple_data, n = 15), 
        desc(overall_score)
    ),
    aes(x = reorder(country, overall_score), y = overall_score, fill = overall_score)
) +
    geom_col(color = "black", linewidth = 0.5) +
    coord_flip() +
    scale_fill_viridis_c(guide = "none") + 
    labs(
        title = "Top 15 Countries by Social Progress Index (SPI)",
        subtitle = paste0("Overall Score in ", max(simple_data$year)),
        x = NULL, 
        y = "SPI Overall Score",
        caption = "Data: World Bank SPI | Visualization: #TidyTuesday"
    ) +
    theme_minimal()

# Print the plot to the Quarto document output
final_bar_chart

#Save the Bar Chart immediately after creation
ggsave(
    filename = here("TidyTuesday", "TidyTues_Nov25", "Output", "spi_top15_bar_chart.png"),
    plot = final_bar_chart, # <-- This variable is now guaranteed to exist
    width = 10,
    height = 7,
    dpi = 300
)
```